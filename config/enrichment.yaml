# Enrichment configuration for F5 XC API specifications

# Source configuration
source:
  url: "https://docs.cloud.f5.com/docs-v2/downloads/f5-distributed-cloud-open-api.zip"
  etag_file: ".etag"
  version_file: ".version"

# Paths configuration
# Simplified two-folder architecture:
#   specs/original/           - READ-ONLY source from F5
#   docs/specifications/api/  - Single output folder for all processed specs (served by GitHub Pages)
paths:
  original: "specs/original"
  enriched: "docs/specifications/api"
  reports: "reports"

# Branding transformations
# Synchronized with f5xc-api-mcp project and xcsh CLI tool for compatibility
branding:
  # Protected patterns - these should NOT be transformed
  # Used to preserve API URLs, console URLs, and schema references
  protected_patterns:
    - "https?://[^\\s]*\\.volterra\\.(io|us)"  # API URLs
    - "console\\.ves\\.volterra\\.io"           # Console URLs
    - "/api/(config|data)/"                     # API paths
    - "\\$ref"                                  # Schema $ref references
    - "ves\\.io\\.schema"                       # Schema namespaces

  replacements:
    # Company/Product naming
    - pattern: "\\bVolterra\\b"
      replacement: "F5 Distributed Cloud"
      case_sensitive: true

    - pattern: "\\bvolterra\\b"
      replacement: "F5 Distributed Cloud"
      case_sensitive: false

    # VoltStack transformations (MCP compatibility)
    - pattern: "\\bVoltStack\\b"
      replacement: "Customer Edge"
      case_sensitive: true

    - pattern: "\\bvoltstack_site\\b"
      replacement: "customer_edge_site"
      case_sensitive: false

    # VES transformations (MCP compatibility)
    - pattern: "\\bVES Console\\b"
      replacement: "F5XC Console"
      case_sensitive: true

    - pattern: "\\bVES\\b"
      replacement: "F5XC"
      case_sensitive: true

    - pattern: "\\bVolterra Edge Services\\b"
      replacement: "F5 Distributed Cloud"
      case_sensitive: true

    # Domain references (be careful not to break URLs in external docs)
    - pattern: "volterra\\.us"
      replacement: "f5xc.io"
      case_sensitive: false
      context: "description"  # Only apply in description fields, not URLs

    # Legacy internal references
    - pattern: "\\bves\\.io\\b"
      replacement: "F5 XC"
      case_sensitive: false
      context: "description"

    # xcsh CLI tool branding (F5 Distributed Cloud Shell)
    # Direct transformation: vesctl → xcsh (skipping f5xcctl intermediate step)
    # Also removes any existing f5xcctl references

    # Environment variable transformations (must come first to handle F5XCCTL_ prefix)
    - pattern: "\\bF5XCCTL_([A-Z_]+)\\b"
      replacement: "XCSH_\\1"
      case_sensitive: true

    - pattern: "\\bVES_([A-Z_]+)\\b"
      replacement: "F5XC_\\1"
      case_sensitive: true

    # CLI tool name transformations
    - pattern: "\\bf5xcctl\\b"
      replacement: "xcsh"
      case_sensitive: true

    - pattern: "\\bF5xcctl\\b"
      replacement: "Xcsh"
      case_sensitive: true

    - pattern: "\\bF5XCCTL\\b"
      replacement: "XCSH"
      case_sensitive: true

    - pattern: "\\bvesctl\\b"
      replacement: "xcsh"
      case_sensitive: true

    - pattern: "\\bVesctl\\b"
      replacement: "Xcsh"
      case_sensitive: true

    - pattern: "\\bVESCTL\\b"
      replacement: "XCSH"
      case_sensitive: true

    # Naming convention: my- prefix → example- prefix (MCP compatibility)
    - pattern: "\\bmy-"
      replacement: "example-"
      case_sensitive: true

    # DNS/Domain examples: my.example.com → www.example.com (standard DNS naming)
    - pattern: "\\bmy\\.(example\\.[a-zA-Z]{2,})"
      replacement: "www.\\1"
      case_sensitive: false

    # DNS/Domain examples: my.OTHERDOMAIN.com → example.OTHERDOMAIN.com
    - pattern: "\\bmy\\.([a-zA-Z0-9][-a-zA-Z0-9]*\\.[a-zA-Z]{2,})"
      replacement: "example.\\1"
      case_sensitive: false

    # Key-value pairs: mykey → example-key
    - pattern: "\\bmykey\\b"
      replacement: "example-key"
      case_sensitive: false

    # Key-value pairs: myvalue → example-value
    - pattern: "\\bmyvalue\\b"
      replacement: "example-value"
      case_sensitive: false

    # Natural language: "my account" → "example account"
    - pattern: "\\bmy account\\b"
      replacement: "example account"
      case_sensitive: false

    # Natural language: "my fast storage" → "example fast storage"
    - pattern: "\\bmy fast storage\\b"
      replacement: "example fast storage"
      case_sensitive: false

    # General fallback: mypool → example-pool, myserver → example-server
    - pattern: "\\bmy([a-z][a-z0-9]*)"
      replacement: "example-\\1"
      case_sensitive: true

    # Tenant naming: AcmeCorp → Example-Corp (F5 XC documentation standard)
    - pattern: "\\bAcmecorp-web\\b"
      replacement: "Example-Corp-web"
      case_sensitive: true

    - pattern: "\\bAcmeCorp\\b"
      replacement: "Example-Corp"
      case_sensitive: true

    - pattern: "\\bacmecorp\\b"
      replacement: "example-corp"
      case_sensitive: false

# Grammar improvements
grammar:
  # Capitalize first letter of sentences
  capitalize_sentences: true

  # Ensure descriptions end with proper punctuation
  ensure_punctuation: true

  # Fix common spacing issues
  normalize_whitespace: true

  # Remove trailing whitespace
  trim_whitespace: true

  # Fix double spaces
  fix_double_spaces: true

# Fields to process for enrichment
target_fields:
  - description
  - summary
  - title
  - x-displayname
  - x-ves-example

# Description structure normalization
description_structure:
  # Strip leading spaces from description lines
  normalize_leading_spaces: true

  # Preserve bullet point indentation
  preserve_bullet_indentation: true

  # Extract Example: sections to x-ves-example field
  extract_examples: true
  remove_extracted_examples: true

  # Extract Validation Rules: to x-validation-rules extension
  extract_validation_rules: true
  remove_extracted_validation: true

  # Extract X-required markers to x-required extension field
  extract_required: true
  remove_extracted_required: true

# Schema fixes for OpenAPI compliance
schema_fixes:
  # Fix schemas that have 'format' but no 'type' field
  fix_format_without_type: true

  # Mapping of format values to their corresponding type
  # (defaults are built-in, this allows overrides)
  # format_type_mapping:
  #   string: string
  #   binary: string
  #   date-time: string
  #   int32: integer
  #   int64: integer
  #   float: number
  #   double: number

# Tag generation settings
tags:
  # Generate top-level tags array with descriptions
  generate_metadata: true

  # Assign tags to operations based on path patterns
  assign_to_operations: true

# Description validation and auto-generation
description_validation:
  # Auto-generate descriptions for operations without them
  auto_generate_operation_descriptions: true

  # Auto-generate descriptions for schemas without them (off by default - more risky)
  auto_generate_schema_descriptions: false

  # Optional prefix for auto-generated descriptions
  description_prefix: ""

# Consistency validation settings
consistency_validation:
  # Validate parameter naming conventions
  validate_parameters: true

  # Validate schema naming patterns
  validate_schemas: true

  # Validate operationId patterns
  validate_operation_ids: true

  # Minimum severity to include in reports (info, warning, error)
  severity_threshold: "warning"

# Fields to preserve (never modify)
preserve_fields:
  - operationId
  - $ref
  - x-ves-proto-rpc
  - x-ves-proto-service
  - x-ves-proto-message
  - x-ves-proto-enum
  - externalDocs
  - x-validation-rules

# OpenAPI validation settings
validation:
  # Validate enriched specs are valid OpenAPI
  validate_after_enrichment: true

  # Fail on validation errors
  fail_on_error: true

  # OpenAPI version to validate against
  openapi_version: "3.0"

# Diff/changelog settings
changelog:
  # Generate diff report
  generate_diff: true

  # Output format for diff
  diff_format: "json"  # json, markdown, or html

  # Include detailed field-level changes
  detailed_changes: true

# Processing settings
processing:
  # Number of specs to process in parallel
  parallel_workers: 4

  # Continue on individual spec errors
  continue_on_error: true

  # Log level (DEBUG, INFO, WARNING, ERROR)
  log_level: "INFO"

# Output settings
output:
  # Indent JSON output
  json_indent: 2

  # Sort keys in output
  sort_keys: false

  # Preserve original file names
  preserve_filenames: true

# Discovery enrichment settings
# Merges live API discovery data into published specifications
# Run 'make discover' first to generate discovery data
discovery_enrichment:
  # Enable discovery-driven enrichment
  # Can also be enabled via: python -m scripts.enrich --use-discovery
  enabled: false

  # Location of discovered specs (from make discover)
  discovered_specs_dir: "specs/discovered"

  # See config/discovery_enrichment.yaml for detailed configuration
